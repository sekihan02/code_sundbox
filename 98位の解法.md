# 98位の解法

コンテストの開催ありがとうございました。

最終評価結果の皆さんの結果の高さにびっくりで上位の知見レポートを早く見てみたいです。

せっかくなので自分のまとめもかね、Bronzeボーダー得点の解法を共有したいと思います



投稿ファイル選択した結果の前処理と回答生成のコードです

[RAG-1-98Solution](https://github.com/sekihan02/RAG-1-98Solution-Repo)



## 使用LLMモデル



基本的にTanuki-8B-dpo-v1.0を使用しましたが、試しに使用した以下のモデルでの結果が最も良かったです。 （他のモデルもコメントアウトで用意していましたが、料金の都合で使用しませんでした）



gpt-4o-2024-05-13（出力結果が英語の場合、日本語への翻訳にgpt-4o-mini-2024-07-18を別途使用）

text-embedding-3-large（novel.zipデータのベクトル化に使用。smallでも良かったかもしれません）



## 概要



novel.zipに対して前処理を行いベクトル化し、質問に対してこれを使いながら回答する構成としました。

※ 今回の課題にフォーカスしたRAGシステムの構造イメージと全く同じ構成です

![](https://static.signate.jp/competitions/1407/mxY8GTPzGwfZuuASGoPvbIhfiaR9EBMza77g3LI0.png)



## うまくいったこと



- 質問に対して、関連性の高い文章を前処理で作成した埋め込みの結果からFaissで検索し、検索結果の小説全文をモデルに入力できる場合は全文を入れるようにしました（しない場合より0.058改善）。



検索結果を上位3つしか使ってなかったので結果が良かっただけかもしれません。



- 「わからない」という回答に対して、その回答と根拠をプロンプトに含めてもう一度回答させ、その結果で上書きしました（しない場合より0.007改善）。

最初の回答では約25の質問に対して「わからない」と返答していました。おそらく見落としがあると思い、もう一度回答させました。その結果、3つに1つ、合計で8つの質問において以下のように回答が上書きされました。改善結果は大きな変化ではないので、PerfectとIncorrectの比率がほぼ五分五分だったのではないかと思ってます。



```

再処理: Question Index 14, Question: 笠原正一君が見た恐ろしい夢の内容は何ですか？

Answer: わからない

Evidence: 提供されたテキストには、笠原翔一が見た恐ろしい夢の内容に関する具体的な情報が含まれていません。そのため、提供されたテキストを使用して回答の理由を説明することはできません。

Unique Titles and Authors:

Title: サーカスの怪人, Author: 江戸川乱歩, CSV File: 6_embeddings.csv

サーカスの怪人 江戸川乱歩

再回答の結果

Answer: 笠原正一君が見た恐ろしい夢の内容は、たくさんの骸骨の首が空から降ってくる夢です。

Evidence: 正一君が見た恐ろしい夢の内容については、以下の文章が根拠となります：  「そのとき、正一君は、恐ろしい夢を見ていました。 うす暗い空から、豆つぶのようなものが、いっぱい、ふってくるのです。それが、下へ落ちてくるほど、だんだん、大きくなってきます。ピンポンの球ぐらいの大きさの白いものが、たくさん、正一君の頭の上に落ちてくるのです。 よく見ると、その白いものには、まっ黒な目と、三角の黒い鼻と、歯をむき出した口がありました。骸骨の首です。何十、何百ともしれぬ骸骨の首が、ふってくるのです。」

```



## うまくいかなかったこと



- 単語のみに前処理を行い埋め込みベクトル化したこと。

- 小説データごとにナレッジグラフまたは構造化データを作成し、それを埋め込みベクトル化して質問に対する検索に使用したこと。



ナレッジグラフは`spacy.load("ja_core_news_sm")`を使ってただエンティティ抽出しただけなので、より質問の内容を考慮するように作れれば結果は変わったかもしれないです



## やるべきだったこと



> 投稿後、サーバーから通知される評価結果情報は精度改善の参考にご利用ください。また、本評価情報を入力とするアルゴリズムの実装は禁止となります。



この活用をしていないので、例えば`function calling`のような仕組みを入れて特定単語をカウントする関数などを使用していたら、もう少し結果は変わったかもしれないと思っています。



### MissingやIncorrectだった質問



小説全部を意識して読むことで回答できるような質問に対して、正答率が悪いような結果になっていました



#### 特定の単語やカテゴリのカウントの質問



- 小説「芽生」で出てくる国名は何種類ですか？

- 「競漕」の中で、文科のボート部メンバーが実際に酒を飲むシーンは何回か？



#### 起きた事象について説明箇所から回答が別の場所にあるような質問



- 主人公が「最後の晩餐（ばんさん）！」と思った理由はなんですか？

- 川島武男は佐世保で赤道直下の強烈な太陽にさらされて日射病になりましたが、どのように回復しましたか？

- 早川が競漕に参加しなかった理由は卒業論文ですか？
